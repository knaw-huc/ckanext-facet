{% ckan_extends %}

{% block primary_content %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>

    <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"
    integrity="sha512-tAGcCfR4Sc5ZP5ZoVz0quoZDYX5aCtEm/eu1KhSLj2c9eFrylXZknQYmxUssFaVJKvvc0dJQixhGjG2yXWiV9Q=="
    crossorigin=""></script>

    <div id="mapid" style="height: 360px;"></div>

    <script type="text/javascript">
    var mymap = L.map('mapid').setView([52.3745403,4.89797550561798], 5);
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidmljZGluZy1kaSIsImEiOiJjamtjajVod28waHN5M3FxZmw4YTMwdWJxIn0.8thy3AiluSOpJrukB8p0xQ', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox.streets',
    accessToken: 'pk.eyJ1IjoidmljZGluZy1kaSIsImEiOiJjamtjajVod28waHN5M3FxZmw4YTMwdWJxIn0.8thy3AiluSOpJrukB8p0xQ'
}).addTo(mymap);    

    {# for r in c.page.items #}
    {% for r in c.page.full_results %}
        {% for spatial in r['extras'] %}
            {% if spatial['key'] == 'spatial' %}
                {% set markers = h.facet_loadjson(spatial['value']) %}
                {% for marker in markers['coordinates'] %}
                    var marker = L.marker({{ marker }}).addTo(mymap);
                {% endfor %}
            {% endif %}

        {% endfor %}
    {% endfor %}
    </script>
    {{ super() }}
    {{ h.facet_len(c.page.full_results) }}

{% endblock %}

{% block secondary_content %}
    {% snippet 'spatial/snippets/spatial_query.html' %}
    {{ super() }}
{% endblock %}